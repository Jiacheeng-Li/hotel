{% extends "base.html" %}

{% block title %}Milestone Rewards Progress - Lumina Hospitality{% endblock %}

{% block breadcrumb %}
<div class="container">
    <nav aria-label="breadcrumb" class="py-1">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">{{ t('home') }}</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('main.account') }}">{{ t('my_account') }}</a></li>
            <li class="breadcrumb-item active">{{ t('milestone_rewards_progress_title') }}</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}

<div class="milestone-progress-container">
    <div class="page-header">
        <h1>{{ t('milestone_rewards_progress_title') }}</h1>
        <p>{{ t('track_progress_view') }} {{ current_year }}</p>
    </div>

    <!-- Milestone Rules -->
    <div class="milestone-rules-card">
        <div class="rules-header" id="rules-header">
            <h2>{{ t('how_milestone_rewards_work') }}</h2>
            <i class="bi bi-chevron-down rules-toggle-icon" id="rules-toggle-icon"></i>
        </div>
        <div class="rules-content" id="rules-content">
        <ul class="rules-list">
            <li>
                <i class="bi bi-check-circle-fill"></i>
                <div>
                    <strong>{{ t('earn_milestone_every_10') }}</strong>
                    <p class="text-muted small mb-0 mt-1">{{ t('starting_at_20_nights') }}</p>
                </div>
            </li>
            <li>
                <i class="bi bi-check-circle-fill"></i>
                <div>
                    <strong>{{ t('choose_your_reward') }}</strong>
                    <p class="text-muted small mb-0 mt-1">{{ t('at_each_milestone_choose') }}</p>
                </div>
            </li>
            <li>
                <i class="bi bi-check-circle-fill"></i>
                <div>
                    <strong>{{ t('annual_reset') }}</strong>
                    <p class="text-muted small mb-0 mt-1">{{ t('milestone_progress_resets') }}</p>
                </div>
            </li>
            <li>
                <i class="bi bi-check-circle-fill"></i>
                <div>
                    <strong>{{ t('use_your_rewards') }}</strong>
                    <p class="text-muted small mb-0 mt-1">{{ t('points_added_immediately') }}</p>
                </div>
            </li>
        </ul>
        </div>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
        <h2>{{ t('your_milestone_progress') }} {{ current_year }} {{ t('milestone_progress') }}</h2>
        
        {% if milestone_progress %}
        <div>
            {% for milestone in milestone_progress %}
            <div class="milestone-item {% if milestone.status == 'claimed' %}claimed{% elif milestone.status == 'unclaimed' %}unclaimed{% elif milestone.is_current %}current{% else %}upcoming{% endif %}">
                <div class="milestone-header">
                    <div class="milestone-title">{{ milestone.nights }} {{ t('nights_milestone') }}</div>
                    <span class="milestone-status status-{{ milestone.status }}">
                        {% if milestone.status == 'claimed' %}
                        <i class="bi bi-check-circle" aria-hidden="true"></i> {{ t('claimed') }}
                        {% elif milestone.status == 'unclaimed' %}
                        {{ t('available') }}
                        {% else %}
                        {{ t('not_reached') }}
                        {% endif %}
                    </span>
                </div>
                
                {% if milestone.is_current %}
                <div class="milestone-details">
                    <div class="detail-item">
                        <span class="detail-label">{{ t('your_progress') }}</span>
                        <span class="detail-value">{{ year_nights }} / {{ milestone.nights }} {{ t('nights') }}</span>
                    </div>
                    {% if year_nights < milestone.nights %}
                    <div class="detail-item">
                        <span class="detail-label">{{ t('nights_needed') }}</span>
                        <span class="detail-value">{{ milestone.nights - year_nights }} {{ t('more_nights') }}</span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                {% if milestone.reward %}
                <div class="reward-info">
                    <div class="detail-label mb-2">{{ t('reward_claimed') }}</div>
                    {% if milestone.reward.reward_type == 'points' %}
                    <span class="reward-type reward-points">
                        <i class="bi bi-star-fill"></i>
                        {{ "{:,}".format(milestone.reward.reward_value|int) }} {{ t('bonus_points') }}
                    </span>
                    {% elif milestone.reward.reward_type == 'breakfast' %}
                    <span class="reward-type reward-breakfast">
                        <i class="bi bi-cup-hot-fill"></i>
                        {{ milestone.reward.reward_value }} {{ t('complimentary_breakfast') if milestone.reward.reward_value == 1 else t('complimentary_breakfasts') }}
                    </span>
                    {% endif %}
                    <div class="text-muted small mt-2">
                        {{ t('claimed') }}: {{ milestone.reward.claimed_at.strftime('%B %d, %Y') if milestone.reward.claimed_at else milestone.reward.created_at.strftime('%B %d, %Y') }}
                    </div>
                    {% if milestone.reward.reward_type == 'breakfast' %}
                    {% set available = milestone.reward.get_available_breakfasts() %}
                    {% set used = milestone.reward.breakfasts_used %}
                    <div class="text-muted small mt-1">
                        {% if used > 0 %}
                        <span class="badge bg-secondary">{{ used }} {{ t('used') }}</span>
                        {% endif %}
                        {% if available > 0 %}
                        <span class="badge bg-success">{{ available }} {{ t('available') }}</span>
                        {% else %}
                        <span class="badge bg-danger">{{ t('all_used') }}</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="reward-info">
                    <div class="detail-label mb-2">{{ t('available_rewards') }}</div>
                    <div class="reward-options-container">
                        <span class="reward-type reward-points">
                            <i class="bi bi-star-fill"></i>
                            5,000 {{ t('bonus_points') }}
                        </span>
                        <span class="reward-type reward-breakfast">
                            <i class="bi bi-cup-hot-fill"></i>
                            2 {{ t('complimentary_breakfasts') }}
                        </span>
                    </div>
                    {% if milestone.status == 'unclaimed' %}
                    <div class="mt-3">
                        <a href="{{ url_for('main.claim_milestone_reward', milestone_nights=milestone.nights) }}" class="btn btn-warning">
                            {{ t('claim_your_reward') }}
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon"><i class="bi bi-building" aria-hidden="true"></i></div>
            <h3>{{ t('no_milestone_progress_yet') }}</h3>
            <p>{{ t('start_booking_stays') }}</p>
            <a href="{{ url_for('main.index') }}" class="btn btn-primary mt-3">{{ t('book_your_first_stay') }}</a>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/milestone_progress.js') }}"></script>
{% endblock %}

