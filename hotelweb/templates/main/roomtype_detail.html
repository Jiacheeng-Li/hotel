{% extends "base.html" %}

{% block title %}{{ roomtype.name }} - HotelWeb{% endblock %}

{% block breadcrumb %}
<div class="container">
    <nav aria-label="breadcrumb" class="py-1">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('main.hotel_detail', hotel_id=roomtype.hotel.id) }}">{{ roomtype.hotel.name }}</a></li>
            <li class="breadcrumb-item active">{{ roomtype.name }}</li>
        </ol>
    </nav>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h2 class="text-primary fw-bold">{{ roomtype.name }}</h2>
        <p class="text-muted fs-5">{{ roomtype.hotel.name }} <span class="badge bg-secondary ms-2">{{ roomtype.hotel.brand.name }}</span></p>

        <!-- Room Image and Description -->
        <div class="row mt-4">
            <div class="col-md-7">
                <div class="p-4 bg-white rounded shadow-sm border">
                    <h5 class="fw-bold mb-3">Room Description</h5>
                    <p>{{ roomtype.description }}</p>
                </div>
            </div>
            <div class="col-md-5">
                {% if roomtype.image_url %}
                <img src="{{ roomtype.image_url }}" class="img-fluid rounded shadow-sm w-100" style="height: 350px; object-fit: cover;" alt="{{ roomtype.name }}">
                {% else %}
                <div class="bg-light rounded shadow-sm d-flex align-items-center justify-content-center" style="height: 350px;">
                    <span class="text-muted">No image available</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Included Amenities -->
        <section class="mb-4" aria-labelledby="amenities-heading">
            <h2 id="amenities-heading" class="h5 fw-bold mb-3 mt-2">
                <i class="bi bi-grid-fill me-2 text-primary" aria-hidden="true"></i>Included Amenities
                <span class="badge bg-primary ms-2">{{ roomtype.amenities|length }} amenit{{ 'ies' if roomtype.amenities|length != 1 else 'y' }}</span>
            </h2>
            {% if roomtype.amenities %}
            <div class="row g-3">
                {% for amenity in roomtype.amenities %}
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm bg-light hover-effect" style="border-left: 4px solid var(--primary-color);">
                        <div class="card-body d-flex align-items-center p-3">
                            <i class="bi bi-check-circle-fill text-success fs-5 me-3" aria-hidden="true"></i>
                            <span class="fw-bold text-primary">{{ amenity.name }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted mb-0">No amenities listed for this room type.</p>
            {% endif %}
        </section>
    </div>

    <div class="col-md-4">
        <div class="card shadow-lg border-0 sticky-top" style="top: 90px; z-index: 1010;">
            <div class="card-body p-4">
                <div class="text-center mb-3">
                    <h3 class="text-success fw-bold mb-0">${{ "{:,.0f}".format(roomtype.price_per_night) }}</h3>
                    <small class="text-muted">per night</small>
                </div>

                {% if current_user.is_authenticated and estimated_points_per_night > 0 %}
                <div class="alert alert-info text-center small mb-3">
                    Earn {{ estimated_points_per_night }} points per night
                </div>
                {% endif %}

                <hr>

                <form action="{{ url_for('main.book_room', roomtype_id=roomtype.id) }}" method="post">
                    {% set default_check_in = request.args.get('check_in', '') %}
                    {% set default_check_out = request.args.get('check_out', '') %}
                    {% set default_rooms = request.args.get('rooms_needed', 1) %}

                    <div class="mb-3">
                        <label class="form-label fw-bold">Check-in</label>
                        <input type="date" name="check_in" class="form-control" required value="{{ default_check_in }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Check-out</label>
                        <input type="date" name="check_out" class="form-control" required value="{{ default_check_out }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Rooms Required</label>
                        <input type="number" name="rooms_needed" class="form-control" min="1" value="{{ default_rooms }}" required>
                    </div>

                    {% if current_user.is_authenticated %}
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg fw-bold">Confirm Booking</button>
                    </div>
                    {% else %}
                    <div class="alert alert-secondary text-center">
                        Please <a href="{{ url_for('auth.login', next=request.url) }}" class="fw-bold">login</a> to book and earn points.
                    </div>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
